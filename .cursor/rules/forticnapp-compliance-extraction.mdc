---
alwaysApply: false
description: Patterns and strategies for extracting compliance framework policy data from FortiCNAPP documentation. Use when extracting policy inventories from CIS or FSBP framework documentation.
---

# FortiCNAPP Compliance Framework Extraction

## Framework Structure Patterns

### CIS AWS Foundations Benchmark v4.0.1
- **Structure**: Multi-page with section links on main page
- **Section Pattern**: Numbered sections like "1. Identity and Access Management", "2. Storage"
- **Extraction**: Follow section links to sub-pages, extract from tables on each sub-page
- **Special Cases**: Some policies appear on main page (not in sections)

### CIS Azure Foundations Benchmark v4.0.0
- **Structure**: Single page with 7 main service sections
- **Sections**: Analytics Services, Compute Services, Identity Services, Management and Governance Services, Networking Services, Security Services, Storage Services
- **Extraction**: Extract from tables within each service section on the same page
- **Section Names**: Use original documentation section names (service categories), no mapping required

### AWS Foundational Security Best Practices (FSBP) Standard
- **Structure**: Single page with service-based sections
- **Section Pattern**: Service names like "AWS Certificate Manager (ACM)", "AutoScaling", "CloudFront"
- **Extraction**: Find h3/h4 headings with service names, extract from following table
- **Special Cases**: Content may appear twice (need duplicate detection), skip control ID headings (e.g., "IAM.1 - ...")

## Extraction Strategies

### Section Detection
- **AWS CIS**: Pattern match on numbered sections (`^\d+\.\s+[A-Z]`)
- **Azure CIS**: Exact match on 7 known service sections
- **FSBP**: Keyword-based detection (service names, "Service", "AWS", "Elastic", etc.)

### Policy ID Extraction
- **Primary Method**: Extract from HTML table cells (more reliable than link-based extraction)
- **Pattern**: `lacework-global-{number}` (case-insensitive regex: `r'lacework-global-(\d+)'`)
- **Fallback**: Extract from links if no tables found
- **Deduplication**: Track seen items using normalized section names as keys (lowercase, stripped)

### Table Extraction
- Find heading (h3/h4) for section
- Locate next `<table>` element after heading
- Extract policy IDs from table cells (td, th)
- Stop at next section heading

## Implementation Notes

- **HTTP Headers**: Always include proper headers (User-Agent, Accept) to avoid 500 errors (see web-scraping.mdc for example)
- **HTML Parsing**: Use BeautifulSoup for parsing HTML content
- **Duplicate Prevention**: Track seen sections using normalized keys (lowercase section names)
- **Section Name Cleaning**: Remove "AWS" prefix, remove parenthetical suffixes like "(ACM)"
- **Heading Filtering**: Skip non-service headings: "Policy Mapping", "Table key", "Adjusted Controls", control IDs (e.g., "IAM.1 - ...")

## Output Format

- **JSON**: Raw extraction with policy IDs and sections
- **CSV**: Merged with reference data (titles, severity, provider)
- **TXT**: Email-ready formatted output
