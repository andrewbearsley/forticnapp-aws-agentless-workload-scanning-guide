---
alwaysApply: true
description: Guide for using Lacework API search endpoint to retrieve all vulnerability assessments for a machine ID, including pagination handling.
---

# Lacework API Vulnerability Assessment Search

## Overview

The `lacework vulnerability host show-assessment` CLI command only returns the most recent assessment. To see all assessments for a machine within a time range, use the API search endpoint.

## API Endpoint

```
POST /api/v2/Vulnerabilities/Hosts/search
```

## Basic Command Structure

```bash
lacework api post /api/v2/Vulnerabilities/Hosts/search \
  -d '{
    "filters": [
      {"field": "mid", "expression": "eq", "value": <MID>}
    ],
    "timeFilter": {
      "startTime": "2026-01-09T00:00:00Z",
      "endTime": "2026-01-16T00:00:00Z"
    },
    "returns": ["mid", "evalCtx", "startTime", "endTime", "evalGuid", "vulnId", "severity"]
  }' \
  --account <account> \
  --api_key <key> \
  --api_secret <secret> \
  --json
```

## Time Range Limit

The API enforces a maximum time range of 7 days between startTime and endTime. If you need a longer range, make multiple requests.

## Pagination

The API returns results in pages of up to 5,000 entries. Check pagination info:

```bash
lacework api post /api/v2/Vulnerabilities/Hosts/search \
  -d '...' \
  --json | \
  jq '.paging'
```

Response includes:
- totalRows: Total number of entries matching the query
- rows: Number of rows in current page (up to 5,000)
- urls.nextPage: URL for next page (null if no more pages)

## Grouping Assessments by evalGuid

Each assessment has a unique evalGuid. Group results to see unique assessments:

```bash
lacework api post /api/v2/Vulnerabilities/Hosts/search \
  -d '...' \
  --json | \
  jq '.data | group_by(.evalGuid) | map({
    evalGuid: .[0].evalGuid,
    collector_type: .[0].evalCtx.collector_type,
    startTime: .[0].startTime,
    endTime: .[0].endTime,
    entry_count: length
  }) | sort_by(.startTime)'
```

## Filter by Collector Type

To get only agentless assessments:

```bash
lacework api post /api/v2/Vulnerabilities/Hosts/search \
  -d '{
    "filters": [
      {"field": "mid", "expression": "eq", "value": <MID>},
      {"field": "evalCtx.collector_type", "expression": "eq", "value": "Agentless"}
    ],
    "timeFilter": {
      "startTime": "2026-01-09T00:00:00Z",
      "endTime": "2026-01-16T00:00:00Z"
    },
    "returns": ["mid", "evalCtx", "startTime", "endTime", "evalGuid"]
  }' \
  --account <account> \
  --api_key <key> \
  --api_secret <secret> \
  --json
```

To get only agent assessments:

```bash
"filters": [
  {"field": "mid", "expression": "eq", "value": <MID>},
  {"field": "evalCtx.collector_type", "expression": "eq", "value": "Agent"}
]
```

## Common Use Cases

### Get All Assessments for Past 7 Days

```bash
lacework api post /api/v2/Vulnerabilities/Hosts/search \
  -d '{
    "filters": [{"field": "mid", "expression": "eq", "value": <MID>}],
    "timeFilter": {
      "startTime": "2026-01-09T00:00:00Z",
      "endTime": "2026-01-16T00:00:00Z"
    },
    "returns": ["mid", "evalCtx", "startTime", "endTime", "evalGuid"]
  }' \
  --account <account> \
  --api_key <key> \
  --api_secret <secret> \
  --json | \
  jq '.data | group_by(.evalGuid) | map({
    collector_type: .[0].evalCtx.collector_type,
    startTime: .[0].startTime,
    entry_count: length
  }) | sort_by(.startTime)'
```

### Count Assessments by Type

```bash
lacework api post /api/v2/Vulnerabilities/Hosts/search \
  -d '...' \
  --json | \
  jq '.data | group_by(.evalCtx.collector_type) | map({
    collector_type: .[0].evalCtx.collector_type,
    assessment_count: (group_by(.evalGuid) | length),
    total_entries: length
  })'
```

### Check Assessment Frequency

```bash
# Check assessments per day
for day in 09 10 11 12 13 14 15; do
  echo "=== 2026-01-$day ==="
  lacework api post /api/v2/Vulnerabilities/Hosts/search \
    -d "{\"filters\":[{\"field\":\"mid\",\"expression\":\"eq\",\"value\":<MID>}],\"timeFilter\":{\"startTime\":\"2026-01-${day}T00:00:00Z\",\"endTime\":\"2026-01-${day}T23:59:59Z\"},\"returns\":[\"mid\",\"evalCtx\",\"startTime\",\"evalGuid\"]}" \
    --account <account> \
    --api_key <key> \
    --api_secret <secret> \
    --json | \
    jq '.data | group_by(.evalGuid) | map({
      collector_type: .[0].evalCtx.collector_type,
      startTime: .[0].startTime
    }) | sort_by(.startTime)'
  echo ""
done
```

## Return Fields

Common fields to include in the returns array:
- mid: Machine ID
- evalCtx: Evaluation context (includes collector_type, hostname)
- startTime: Assessment start time
- endTime: Assessment end time
- evalGuid: Unique assessment identifier
- vulnId: CVE ID
- severity: Vulnerability severity
- status: Assessment status

## Notes

- The CLI command `show-assessment` only returns the most recent assessment
- Use API search to see all assessments within a time range
- Results are paginated (5,000 entries per page)
- Time range is limited to 7 days maximum
- Group by evalGuid to see unique assessments
- Each assessment can have thousands of vulnerability entries

## Troubleshooting

If you see fewer assessments than expected:
- Check if pagination is limiting results (check .paging.totalRows vs returned rows)
- Verify time range is correct (7 day limit)
- Check if filters are too restrictive
- Verify the machine ID is correct

If results seem incomplete:
- Check .paging.urls.nextPage for additional pages
- Increase time range (split into multiple 7-day windows if needed)
- Verify all required fields are in the returns array
