---
alwaysApply: true
description: Lacework CLI usage patterns, commands, and best practices. Use when working with Lacework CLI for investigations, queries, or configuration checks.
---

# Lacework CLI Usage Guide

## Documentation
- **CLI Reference**: https://docs.fortinet.com/document/forticnapp/latest/cli-reference
- **API Reference**: https://docs.fortinet.com/document/forticnapp/latest/api-reference
- **Interactive API Docs**: https://api.lacework.net/api/v2/docs

## Authentication

### Using API Keys from JSON Files
When API credentials are provided in JSON format, extract and use them with command flags:

```bash
# Read JSON file first to get credentials
# Then use with --account, --api_key, and --api_secret flags

lacework <command> \
  --account <account-from-json> \
  --api_key <keyId-from-json> \
  --api_secret <secret-from-json>
```

### Profile Management
- List configured profiles: `lacework configure list`
- Switch profiles: `lacework configure switch-profile <profile-name>`
- Profiles are stored in `~/.lacework.toml`

## Important Command Notes

### Slow Commands - Avoid Unless Necessary
- **`lacework vulnerability host list-cves`** - Takes a very long time to execute. Only use when absolutely necessary.
- Prefer more specific queries or filters when possible.

### Read-Only Investigation
When investigating customer environments:
- Use read-only commands: `list`, `show`, `query`, `get`
- Avoid write commands: `create`, `delete`, `update`, `modify`
- Always confirm commands are read-only before execution

## Common Commands

### Cloud Account Management
```bash
# List all cloud account integrations
lacework cloud-account list [--json]

# Show details of a specific cloud account
lacework cloud-account show <GUID> [--json]

# Types include: AzureSidekick, AwsSidekickOrg, AzureCfg, AzureAlSeq, AwsCfg
```

### Agent Management
```bash
# List all agents (can be slow with many agents)
lacework agent list

# Note: Agent list shows both agent-based and agentless-scanned hosts
# Look for OS/architecture to distinguish (agentless may show different patterns)
```

### Vulnerability Assessment
```bash
# Host vulnerability commands
lacework vulnerability host list-hosts <CVE_ID>  # List hosts with specific CVE
lacework vulnerability host show-assessment <MID>  # Show assessment for specific host

# AVOID: lacework vulnerability host list-cves (very slow)
```

### Query Language (LQL)
```bash
# List available queries
lacework query list

# List available datasources
lacework query list-sources

# Preview a datasource
lacework query preview-source <datasource>

# Run a query
lacework query run <query_id>

# Show query details
lacework query show <query_id>
```

### Alerts
```bash
# List alerts
lacework alert list

# Show alert details
lacework alert show <GUID>
```

## Command Structure

### Global Flags
- `--account <string>` - Account subdomain (e.g., `unsw.lacework.net` or just `unsw`)
- `--api_key <string>` - API access key ID
- `--api_secret <string>` - API secret access key
- `--json` - Output in JSON format (useful for parsing)
- `--debug` - Enable debug logging
- `--noninteractive` - Disable interactive mode (spinners, prompts)
- `--nocolor` - Disable colored output
- `--profile <string>` - Use specific configured profile

### Output Formatting
- Default: Human-readable table format
- `--json`: Machine-readable JSON format
- Use `| cat` or `--noninteractive` to avoid pagers/spinners

## Azure Agentless Workload Scanning Investigation

### Key Integration Details
- **Type**: `AzureSidekick` (Azure agentless workload scanning)
- **Status**: Check `STATUS` column (Enabled/Disabled)
- **State**: Check `STATE` column (Ok/Pending/Error)
- **Last Successful Time**: Check `LAST SUCCESSFUL STATE` field

### Investigation Commands
```bash
# 1. List all cloud accounts to find Azure agentless integration
lacework cloud-account list --account <account> --api_key <key> --api_secret <secret>

# 2. Show detailed configuration of Azure agentless integration
lacework cloud-account show <GUID> --account <account> --api_key <key> --api_secret <secret> --json

# 3. Check integration state details
# Look for: lastSuccessfulTime, state.ok, state.details.message
```

### Key Fields to Check
- `enabled`: 1 = Enabled, 0 = Disabled
- `state.ok`: true/false
- `state.lastSuccessfulTime`: Timestamp of last successful scan
- `state.details.message`: Status message
- `scanFrequency`: Hours between scans (e.g., 6 = every 6 hours)
- `scanHostVulnerabilities`: true/false
- `scanContainers`: true/false
- `scanStoppedInstances`: true/false

## Best Practices

1. **Always use read-only commands for investigations**
2. **Extract credentials from JSON files rather than hardcoding**
3. **Use `--json` flag when parsing output programmatically**
4. **Use `--noninteractive` for scripts/automation**
5. **Avoid slow commands like `list-cves` unless necessary**
6. **Check command help: `lacework <command> --help`**
7. **Use `| cat` or `--noninteractive` to avoid pagers**
8. **For large outputs, use `head -N` or `tail -N` to limit results**

## Common Patterns

### Extracting Credentials from JSON
```bash
# Read JSON file
cat api-keys/unsw-lw-api-key.json | jq -r '.account, .keyId, .secret'
```

### Checking Integration Health
```bash
# List integrations and check STATUS and STATE columns
lacework cloud-account list --account <account> --api_key <key> --api_secret <secret>

# Get detailed status with JSON output
lacework cloud-account show <GUID> --account <account> --api_key <key> --api_secret <secret> --json | jq '.state'
```

### Finding Azure Agentless Integration
```bash
# Filter for AzureSidekick type
lacework cloud-account list --account <account> --api_key <key> --api_secret <secret> | grep AzureSidekick
```

## Troubleshooting

- If commands hang, check if it's a slow command (like `list-cves`)
- Use `--debug` flag to see detailed API calls
- Check `state.details.message` in JSON output for error messages
- Verify credentials are correct and account name matches JSON file
- Ensure using correct account format (with or without `.lacework.net` suffix)
